<div class="max-w-6xl mx-auto mt-10">

  <h1 class="text-3xl font-bold text-green-400 mb-8">
    üåø Cana-ML ‚Ä¢ Agro Analytics
  </h1>

  <!-- GRID PRINCIPAL -->
  <section class="grid grid-cols-1 lg:grid-cols-2 gap-8">

    <!-- CARD: UPLOAD -->
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 relative">

      <!-- PR√â-VISUALIZA√á√ÉO -->
      <div id="previewBox" class="hidden mt-4">
        <p class="text-gray-300 mb-2">üñºÔ∏è Pr√©-visualiza√ß√£o</p>
        <img id="previewImage"
             class="w-full max-h-72 object-cover rounded-lg border border-gray-700 shadow">
      </div>

      <h2 class="text-xl font-semibold mb-4 text-green-300 mt-4">An√°lise de Imagem</h2>

      <form id="predictForm" class="space-y-4">
        <input type="file" name="image" id="image"
               class="w-full text-sm text-gray-300 file:bg-gray-700
                      file:border-0 file:px-3 file:py-2 file:rounded file:text-gray-200
                      hover:file:bg-gray-600 cursor-pointer">

        <button id="btnAnalyze" type="submit"
                class="bg-green-600 hover:bg-green-500 py-2 px-4 rounded w-full text-center
                       transition disabled:opacity-40 disabled:cursor-not-allowed">
          Analisar Imagem
        </button>
      </form>

      <!-- RESULTADO -->
      <div id="result" class="mt-6 text-sm"></div>

      <!-- LOADER -->
      <div id="loadingOverlay"
           class="hidden absolute inset-0 bg-black bg-opacity-60 flex flex-col
                  items-center justify-center rounded-xl">

        <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-green-400"></div>
        <p class="text-green-300 mt-4 text-sm">Analisando imagem...</p>
      </div>
    </div>

    <!-- CARD: √öLTIMAS AN√ÅLISES -->
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">

      <h2 class="text-xl font-semibold mb-4 text-green-300">√öltimas an√°lises</h2>

      <div id="recentList" class="flex flex-col gap-4"></div>

    </div>

  </section>
</div>

<script>
/* ELEMENTOS */
const form = document.getElementById("predictForm");
const loadingOverlay = document.getElementById("loadingOverlay");
const button = document.getElementById("btnAnalyze");
const imageInput = document.getElementById("image");
const previewBox = document.getElementById("previewBox");
const previewImage = document.getElementById("previewImage");

/* =====================================================
      PR√â-VISUALIZA√á√ÉO DA IMAGEM
===================================================== */
imageInput.addEventListener("change", () => {
  const file = imageInput.files[0];
  if (!file) {
    previewBox.classList.add("hidden");
    return;
  }

  const imageURL = URL.createObjectURL(file);
  previewImage.src = imageURL;
  previewBox.classList.remove("hidden");
});

/* =====================================================
      SUBMIT / PREDICT
===================================================== */
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  if (!imageInput.files.length) {
    alert("Selecione uma imagem antes de analisar!");
    return;
  }

  loadingOverlay.classList.remove("hidden");
  button.disabled = true;

  document.getElementById("result").innerHTML = "";

  const data = new FormData(form);
  const res = await fetch("/predict", { method: "POST", body: data });
  const result = await res.json();

  loadingOverlay.classList.add("hidden");
  button.disabled = false;

  if (result.error) {
    document.getElementById("result").innerHTML =
      `<p class="text-red-400">${result.error}</p>`;
    return;
  }

  /* =====================================================
        CARD DE RESULTADO
  ===================================================== */
  document.getElementById("result").innerHTML = `
    <div class="bg-gray-900 border border-gray-700 rounded-xl p-4 mt-4 flex gap-4">

      <img src="/uploads/${result.file}"
           class="w-32 h-32 object-cover rounded-lg shadow">

      <div class="flex-1">

<h3 class="text-2xl font-bold flex items-center gap-2">
  ${getClassIcon(result.class)} 
  <span class="${getClassColor(result.class).replace('bg-', 'text-')}">
    ${result.class}
  </span>
</h3>


        <p class="text-sm text-gray-300 mt-1">${result.explain}</p>

        <p class="text-sm text-gray-400 mt-3">
          <b>Confian√ßa:</b> ${(result.confidence * 100).toFixed(1)}%
        </p>

        <div class="w-full bg-gray-700 rounded h-2 mt-1">
          <div class="${getColorClass(result.class)} h-2 rounded"
               style="width:${(result.confidence * 100).toFixed(1)}%"></div>
        </div>

        <p class="text-xs text-gray-500 mt-3"><b>Arquivo:</b> ${result.file}</p>
      </div>
    </div>
  `;

  loadRecent();
});

/* =====================================================
      √öLTIMAS AN√ÅLISES
===================================================== */
async function loadRecent() {
  const res = await fetch("/recent");
  const data = await res.json();
  const list = document.getElementById("recentList");

  if (!data.length) {
    list.innerHTML =
      `<p class="text-gray-400 text-sm">Nenhuma an√°lise recente encontrada.</p>`;
    return;
  }

  list.innerHTML = data
    .map((r) => `
      <div class="flex items-center gap-4 bg-gray-900 rounded-xl p-4 border border-gray-700
                  hover:border-green-400 transition">

        <img src="/uploads/${r.file}"
             class="w-20 h-20 object-cover rounded-lg shadow">

        <div class="flex-1">

          <p class="text-lg font-semibold flex items-center gap-2">
  ${getClassIcon(r.class)}
  <span class="${getClassColor(r.class).replace('bg-', 'text-')}">
    ${r.class}
  </span>
</p>

          <p class="text-sm text-gray-300 mb-1">
            Confian√ßa: <b>${(r.confidence * 100).toFixed(1)}%</b>
          </p>

          <div class="w-full bg-gray-700 rounded h-2 mb-1">
            <div class="${getColorClass(r.class)} h-2 rounded"
                 style="width:${(r.confidence * 100).toFixed(1)}%"></div>
          </div>

          <p class="text-xs text-gray-400">Arquivo: ${r.file}</p>
        </div>
      </div>
    `)
    .join("");
}

/* =====================================================
      CORES POR CLASSE
===================================================== */
function getColorClass(cls) {
  switch (cls) {
    case "Sadia": return "bg-green-500";
    case "Ferrugem": return "bg-yellow-500";
    case "Mosaico": return "bg-red-500";
    case "Broca": return "bg-purple-500";
    default: return "bg-blue-500";
  }
}
/* =====================================================
      CORES POR CLASSE  (NOVA VERS√ÉO)
===================================================== */
function getClassColor(cls) {
  switch (cls) {
    case "Sadia": return "bg-green-500";
    case "Ferrugem": return "bg-yellow-500";
    case "Mosaico": return "bg-red-500";
    case "Broca": return "bg-purple-500";
    default: return "bg-blue-500";
  }
}

/* =====================================================
      √çCONES POR CLASSE
===================================================== */
function getClassIcon(cls) {
  switch (cls) {
    case "Sadia": return "üå±";
    case "Ferrugem": return "üçÅ";
    case "Mosaico": return "üß¨";
    case "Broca": return "üêõ";
    default: return "üîç";
  }
}

/* =====================================================
      BADGE FORMATADA (cor + √≠cone)
===================================================== */
function renderBadge(cls) {
  return `
    <span class="inline-flex items-center gap-2 bg-gray-700 px-3 py-1 rounded-full text-sm">
      <span>${getClassIcon(cls)}</span>
      <span class="font-semibold text-green-300">${cls}</span>
    </span>
  `;
}


loadRecent();
</script>






